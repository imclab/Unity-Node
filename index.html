<html>
    <head>
        <title>Unity MMORogue</title>
        <link rel="stylesheet" type="text/css" href="unity.css" />
    </head>
    <body>
		<div id="thegame">
        	<div id="map">
        	</div>
		</div>
		<div id="login">
        	<div id="floater">
        	</div>
        	<div id="content">
            	<p style="text-align:center">
                	<label for="nameText">What is your name, traveller?</label>
                	<input type="text" id="nameText"/>
            	</p>
        	</div> 
        </div>
		
        <div id="messages">
			<div>
				Level Chat:
			<div id="level">
			</div>
			<div>
				<input type="text" id="levelChat"/>
			</div>
        </div>
        <script type="text/javascript"
                src="/socket.io/socket.io.js"></script>
        <script type="text/javascript"
                src="http://code.jquery.com/jquery.min.js"></script>

        <script type="text/javascript">
            $(document).ready(function() {
                var webSocket = new io.connect();
                // webSocket.connect();

                webSocket.on('level chat', function(message) {
    	            $('#level').append(message + '</br>');
                });
                
                webSocket.on('map', function (message) {
                    $('#map').replaceWith("<div id='map'>" + message + "</div>");
                    
                })

                $('#nameText').keypress(function(event) {
                    if (event.which == 13) {
                        var message = $('#nameText').val();
                        webSocket.emit('new user', message);
                        $('#nameText').val('');
						$('#login').hide();
						$("#messages").show();
                        webSocket.emit('send map');
                    }
					event.stopPropagation();
                });

                $('#levelChat').keypress(function(event) {
                    if (event.which == 13) {
                        var message = $('#levelChat').val();
                        webSocket.emit('level chat', message);
                        $('#levelChat').val('');
                    }
					event.stopPropagation();
                });


                $('html').keypress(function (event) {
	                var keycode = (event.keyCode ? event.keyCode : event.which);
	                var message = "";
	                switch (keycode) {
		                case 104:
		                  message = "-1 0";
		                  webSocket.emit('move', message);
		                  break;
		                case 106:
		                  message = "0 1";
		                  webSocket.emit('move', message);
		                  break;
		                case 107:
		                  message = "0 -1";
		                  webSocket.emit('move', message);
		                  break;
		                case 108:
		                  message = "1 0";
		                  webSocket.emit('move', message);
		                  break;
		                case 121:
		                  message = "-1 -1";
		                  webSocket.emit('move', message);
		                  break;
		                case 117:
		                  message = "1 -1";
		                  webSocket.emit('move', message);
		                  break;
		                case 98:
		                  message = "-1 1";
		                  webSocket.emit('move', message);
		                  break;
		                case 110:
		                  message = "1 1";
		                  webSocket.emit('move', message);
		                  break;
                    }
                });
				$('#login').show();
                
            });
        </script>
    </body>
</html>